<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>TFFC Donation Alerts</title>
		
		<style>
		</style>
	</head>
	<body>
		<div id="donation-alert"></div>
		<script>
			'use strict';
			
			// Configuration
			const extraLifeParticipantID = 478114;
			const secondsUntilAlertDisappears = 10;
			const checkIntervalInSeconds = 60; // DonorDrive API requests are limited to 15 seconds.
							   // Let's use 60 seconds, since multiple users will be using this.
							   // We aren't using etags to check either. So let's not poll too often.

			let latestCreatedDateUTC = null;
			let oldDate = null;
			let newDate = null;

			async function checkForNewDonation() {
				const response = await fetch('https://extra-life.org/api/participants/' + extraLifeParticipantID  + '/donations');
				const data = await response.json();
				let createdDateUTC = data[0].createdDateUTC;
				if (typeof createdDateUTC === 'string') {
					newDate = new Date(createdDateUTC);
					oldDate = new Date(latestCreatedDateUTC);
					if (newDate > oldDate) {
						showDonationAlert(data[0]);
					}
					latestCreatedDateUTC = createdDateUTC;
				}
  			}
                        function showDonationAlert(donationObject) {
                                let donationAlert = document.getElementById('donation-alert');
				let displayName = 'Someone';
				if (donationObject.displayName !== undefined) {
					displayName = donationObject.displayName;
				}
                                donationAlert.innerHTML = displayName + ' donated $' + donationObject.amount;
				setTimeout(function() {
					donationAlert.innerHTML = '';
				}, secondsUntilAlertDisappears * 1000);
                        }

			checkForNewDonation();
			setInterval(checkForNewDonation, checkIntervalInSeconds * 1000);
		</script>
	</body>
</html>

